package utils

import (
	"encoding/json"
	"fmt"
	"io/ioutil"
	"os"

	"github.com/brian1917/illumioapi"
)

// GetPCE reads the PCE information from the JSON generated by the login command
func GetPCE() (illumioapi.PCE, error) {
	var pce illumioapi.PCE

	file := os.Getenv("ILLUMIO_PCE")
	if file == "" {
		file = "pce.json"
	}

	jsonFile, err := os.Open(file)
	if err != nil {
		return pce, fmt.Errorf("GetPCE error opening JSON file - %s", err)
	}
	defer jsonFile.Close()

	byteValue, err := ioutil.ReadAll(jsonFile)
	if err != nil {
		return pce, fmt.Errorf("GetPCE error reading JSON file - %s", err)
	}

	json.Unmarshal(byteValue, &pce)

	return pce, nil
}
